@using Library.DataAccess.Domain
@using Newtonsoft.Json
@model IEnumerable<Library.DataAccess.Domain.Posts>;
@{
    ViewData["Title"] = "Buscar";
    var groupedPostsCount = 0;
    var defaultImage = "/img/esfelogo-expanded.png";
    var postImage = "";
}
<head>
    <link href="https://fonts.googleapis.com/css?family=Inria+Sans&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/PostsFeed.css" asp-append-version="true" />
</head>

<body>
    <div class="card">
        <div class="card-body">
    <div style="text-align: center; padding: 8px;">
        @*Buscador*@
        <div>
            <form asp-action="Search" method="get" class="d-flex flex-column flex-md-row align-items-center justify-content-center p-4">
                <!-- Input de búsqueda -->
                <div class="m-2 w-100">
                    <input type="text" name="Query" class="form-control" id="Query" placeholder="Buscar..." />
                </div>

                <!-- Contenedor para los otros elementos -->
                <div class="d-flex flex-column flex-md-row w-100 justify-content-between">
                    <!-- Input de categoría -->
                    <div class="mb-2 mb-md-0 w-100 me-md-2">
                        <select class="form-select" id="CategoryId" name="CategoryId">
                            <option value="0">Categoría</option>
                            @foreach (PostsCategories item in ViewBag.Categories)
                            {
                                <option value="@item.Id">@item.Name</option>
                            }
                        </select>
                    </div>

                    <!-- Input de fecha -->
                    <div class="mb-2 mb-md-0 w-100 me-md-2">
                        <input type="date" class="form-control" id="Date" name="Date" />
                    </div>

                    <!-- Botón de búsqueda -->
                    <div class="w-100">
                        <button type="submit" class="btn btn-primary w-100">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                            </svg>
                            Buscar
                        </button>
                    </div>
                </div>
            </form>

            @if(Model.Count() > 0)
            {
                <h2 class="" style="font-weight: bold;">@Model.Count() Resultados</h2>  
            }
            <div class="p-2 m-2">
                <div class="">
                    <div class="row lastposts justify-content-center">
                        @foreach (var post in Model)
                        {
                            {
                                postImage = post.IMAGES.Take(1).FirstOrDefault()?.PATH ?? defaultImage ;
                            }
                            
                                <div class="postcard-2 col-md-2">
                                    <a href="/Posts/Details/@post.ID" style="text-decoration: none;">
                                        <img class="postimage-2" src="@postImage" />
                                        <p class="postcategoryname-2">@post.CATEGORY.Name</p>
                                        <p class="posttitle-2">@post.TITLE</p>
                                        <p class="postcontent-2">@post.CONTENT</p>
                                    </a>
                                </div>
                        }
                    </div>
                </div>
            </div>
            
        </div>
        @if(Model.Count() == 0)
        {
            <h2 class="mt-3" style="font-weight: bold;">No hay ninguna coincidencia</h2>
        }
    </div>
    </div>
    </div>
</body>

@section Scripts {
    <script>
        document.querySelector('.main-content').classList.remove('with-menu');
        document.querySelector('.main-content').classList.add('full-width');
    </script>
}